{"version":3,"sources":["../app/ec-encrypt.js"],"names":[],"mappings":";;;;;;AAAA;;;;;;AAEA,IAAM,WAAW,EAAX;;AAEN,SAAS,cAAT,CAAwB,GAAxB,EAA6B,IAA7B,EAAmC,WAAnC,EAAgD;AAC9C,MAAI,cAAc,IAAI,MAAJ,GAAa,KAAK,MAAL,GAAc,YAAY,MAAZ,CADC;AAE9C,MAAI,QAAQ,OAAO,MAAP,CAAc,CAAC,GAAD,EAAM,WAAN,EAAmB,IAAnB,CAAd,EAAwC,WAAxC,CAAR,CAF0C;AAG9C,UAAQ,MAAM,QAAN,CAAe,QAAf,CAAR,CAH8C;AAI9C,UAAQ,UAAU,KAAV,CAAR,CAJ8C;;AAM9C,SAAO,KAAP,CAN8C;CAAhD;;AASA,SAAS,SAAT,CAAmB,IAAnB,EAAyB,GAAzB,EAA8B,MAA9B,EAAsC;AACpC,MAAM,SAAS,iBAAO,cAAP,CAAsB,aAAtB,EAAqC,IAArC,EAA2C,GAA3C,CAAT,CAD8B;AAEpC,MAAI,YAAY,OAAO,MAAP,CAAc,MAAd,CAAZ,CAFgC;AAGpC,MAAI,QAAQ,OAAO,KAAP,EAAR,CAHgC;AAIpC,MAAI,cAAc,UAAU,MAAV,GAAmB,MAAM,MAAN,CAJD;;AAMpC,cAAY,OAAO,MAAP,CAAc,CAAC,SAAD,EAAY,KAAZ,CAAd,EAAkC,WAAlC,CAAZ,CANoC;;AAQpC,SAAO;AACL,gBAAY,SAAZ;AACA,SAAK,OAAO,UAAP,EAAL;GAFF,CARoC;CAAtC;;AAcA,SAAS,UAAT,GAAsB;AACpB,SAAO,iBAAO,WAAP,CAAmB,QAAnB,CAAP,CADoB;CAAtB;;AAIA,SAAS,YAAT,CAAsB,GAAtB,EAA2B;AACzB,SAAO,iBAAO,UAAP,CAAkB,QAAlB,EAA4B,GAA5B,EAAiC,MAAjC,EAAP,CADyB;CAA3B;;AAIA,SAAS,aAAT,CAAuB,MAAvB,EAA+B,GAA/B,EAAoC;AAClC,MAAM,OAAO,KAAK,YAAL,CAAkB,GAAlB,CAAP,CAD4B;AAElC,MAAM,MAAM,KAAK,UAAL,EAAN,CAF4B;AAGlC,MAAM,cAAc,KAAK,SAAL,CAAe,IAAf,EAAqB,GAArB,EAA0B,IAAI,MAAJ,CAAW,MAAX,CAA1B,CAAd,CAH4B;AAIlC,MAAM,SAAS,KAAK,cAAL,CAAoB,GAApB,EAAyB,YAAY,GAAZ,EAAiB,YAAY,UAAZ,CAAnD,CAJ4B;;AAMlC,UAAQ,GAAR,CAAY,YAAZ,EAA0B,WAA1B,EANkC;AAOlC,UAAQ,GAAR,CAAY,QAAZ,EAAsB,MAAtB,EAPkC;AAQlC,SAAO,MAAP,CARkC;CAApC;;AAWA,SAAS,IAAT,CAAe,IAAf,EAAqB;AACnB,MAAI,MAAM,KAAK,CAAL,CAAN,CADe;AAEnB,MAAI,SAAS,KAAK,CAAL,CAAT,CAFe;;AAInB,UAAQ,GAAR,CAAY,KAAZ,EAAmB,GAAnB,EAJmB;AAKnB,UAAQ,GAAR,CAAY,QAAZ,EAAsB,MAAtB,EALmB;AAMnB,OAAK,aAAL,CAAmB,MAAnB,EAA2B,GAA3B,EANmB;CAArB;;kBASe;AACb,YADa;AAEb,8BAFa;AAGb,4BAHa;AAIb,wBAJa;AAKb,sBALa;AAMb,gCANa","file":"ec-encrypt.js","sourcesContent":["import crypto from 'crypto';\n\nconst G_IV_LEN = 12;\n\nfunction constructToken(lIv, lTag, lCiphertext) {\n  let totalLength = lIv.length + lTag.length + lCiphertext.length;\n  let token = Buffer.concat([lIv, lCiphertext, lTag], totalLength);\n  token = token.toString('base64')\n  token = encodeURI(token);\n\n  return token;\n}\n\nfunction ecEncrypt(aKey, aIv, string) {\n  const cipher = crypto.createCipheriv('aes-256-gcm', aKey, aIv);\n  let encrypted = cipher.update(string);\n  let final = cipher.final();\n  let totalLength = encrypted.length + final.length;\n\n  encrypted = Buffer.concat([encrypted, final], totalLength);\n\n  return {\n    ciphertext: encrypted,\n    tag: cipher.getAuthTag()\n  };\n}\n\nfunction generateIv() {\n  return crypto.randomBytes(G_IV_LEN);\n}\n\nfunction generateHmac(key) {\n  return crypto.createHmac('sha256', key).digest();\n}\n\nfunction generateToken(string, key) {\n  const lKey = this.generateHmac(key);\n  const lIv = this.generateIv();\n  const lCiphertext = this.ecEncrypt(lKey, lIv, new Buffer(string));\n  const lToken = this.constructToken(lIv, lCiphertext.tag, lCiphertext.ciphertext);\n\n  console.log('ciphertext', lCiphertext);\n  console.log('lToken', lToken);\n  return lToken;\n}\n\nfunction main (argv) {\n  let key = argv[2];\n  let string = argv[3];\n\n  console.log('key', key);\n  console.log('string', string);\n  this.generateToken(string, key);\n}\n\nexport default {\n  main,\n  generateToken,\n  generateHmac,\n  generateIv,\n  ecEncrypt,\n  constructToken\n}\n"]}